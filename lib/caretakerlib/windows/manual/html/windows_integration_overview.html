<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.14"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Caretaker Library API 1.6.5 Reference Manual: Library Integration</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Caretaker Library API 1.6.5 Reference Manual
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.14 -->
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',false,false,'search.php','Search');
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">Library Integration </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p><br />
 This section provides an overview of the library integration with Windows applications.</p>
<h2>Library Package</h2>
<p>Windows versions of the library are released in zip format <em>ctlibrary-windows-VERSION.zip</em>, where <em>VERSION</em> is the library version number. <br />
The archive bundle contains the following components.</p>
<table class="doxtable">
<tr>
<th>Component </th><th>Description </th></tr>
<tr>
<td>examples </td><td>Examples illustrating library usage. </td></tr>
<tr>
<td>manual </td><td>The library API documentation. Documentation is available in pdf and html formats. The pdf version is supplied for completeness though the formatting is optimized for viewing in html format. Open <em>html/index.html to view the html version main page.</em>. </td></tr>
<tr>
<td>Win32 </td><td>If present, this directory stores the library 32-bit (x86) version. </td></tr>
<tr>
<td>Win64 </td><td>If present, this directory stores the library 64-bit (x64) version. </td></tr>
<tr>
<td>caretaker_static.h </td><td>Header file to include when linking with the unmanaged libcaretaker_static.lib. </td></tr>
<tr>
<td>caretaker_dynamic.h </td><td>Header file to include when linking with the unmanaged libcaretaker_dynamic.dll. </td></tr>
<tr>
<td>libcaretaker_static.lib </td><td>The unmanaged C/C++ library image to use for static linking with native applications. </td></tr>
<tr>
<td>libcaretaker_dynamic.dll </td><td>The unmanaged C/C++ library image to use for dynamic linking with native applications. </td></tr>
<tr>
<td>libcaretaker_clr.dll </td><td>Managed CLR library image to use for linking with .NET framework 4.0 or later applications. </td></tr>
</table>
<h2>Supported Platforms</h2>
<p>This library version tested successfully with applications designed for the following configurations.</p>
<p>OS Version </p><ul>
<li>
Windows 7 Version 6.1. 7601 SP1 or later </li>
<li>
Windows 8.1, Update 1 Version 6.3.9600 or later </li>
<li>
Windows 10 Version 1709, Build 16299 or later </li>
</ul>
<p>Platform </p><ul>
<li>
Win32 (x86) </li>
<li>
Win64 (x64) </li>
</ul>
<p>Build Tools </p><ul>
<li>
Visual Studio 2015 </li>
<li>
Visual Studio 2017 </li>
</ul>
<h2>Software Configuration</h2>
<p>Windows 7 Version 6.1. 7601 SP1 or later installed for Windows 7 application linked with the library.</p>
<p>Windows 8.1, Update 1 Version 6.3.9600 or later for Windows 8.1 application linked with the library.</p>
<p>Windows 10 Version 1709, Build 16299 or later for Windows 10 application linked with the library.</p>
<h2>Hardware Configuration</h2>
<p>Bluetooth Low Energy (BLE) will need to be setup on Windows prior to connecting the application to the Caretaker device. Note that native Windows BLE is not supported in this release of the Caretaker library so an external BLE dongle is required. The supported dongles are TI CC2540 dongles. Note Bluegiga BLE112 dongles also work but have shorter range. Plug the dongle into a USB port on the PC and install the necessary drivers. After successful setup, the dongle will appear as a virtual COM port in Windows Device Manager. The library will detect the dongle automatically when it is plugged into the PC thereafter.</p>
<h2>Linking with the Managed Library</h2>
<p>The Common Language Runtime (CLR) wrapper library (libcaretaker_clr.dll) is available to integrate .NET 4.0 or later applications with the Caretaker device. To use it, copy libcaretaker_clr.dll (the managed library) and libcaretaker_dynamic.dll (the unmanaged library) to the application project directory then add a reference to libcareteker_clr.dll. For Visual Studio projects, the reference can be added by right-clicking the application project then selecting Add Reference and then browsing to libcaretaker_clr.dll and selecting it.</p>
<p>Note both DLLs will be loaded at runtime when the application is executed and are expected to be located with the application executable (.exe) file. So they must be copied also to the target directory where the application executable file is saved. The copy can be done manually after building the application, or the build can be configured to copy them to the target directory with the executable. For Visual Studio, this can be done by right-clicking the project then selecting Properties and then Build Events and adding the following Post-build event command line.</p>
<div class="fragment"><div class="line">copy /B /Y <span class="stringliteral">&quot;$(ProjectDir)libcaretaker_dynamic.dll&quot;</span> <span class="stringliteral">&quot;$(TargetDir)&quot;</span></div></div><!-- fragment --><h2>Linking with the Unmanaged Library</h2>
<p>Native Win32 applications can link the with the unmanaged library using either implicit or explicit linking.</p>
<h3>Implicit Linking</h3>
<p>Add the following files to the application project to link implicitly with the library. </p><ul>
<li>
caretaker_static.h </li>
<li>
libcaretaker_static.lib </li>
</ul>
<h4>caretaker_static.h</h4>
<p>This header file contains the exported library functions that are callable from within the application. Add it to the application source (or include) folder and then include it in each source file that will call library functions.</p>
<h4>libcaretaker_static.lib</h4>
<p>Add libcaretaker_static.lib to the application source (or lib) directory and include it in the library path where the linker can find it. If using an external makefile, add libcaretaker_static.lib where the object files (.obj) and other libraries are listed. If Visual Studio, add it to the project Linker Input configuration where the other libraries are listed.</p>
<p>Additionally, the following Windows system libraries must be added to the project to resolve libcaretaker dependencies. </p><ul>
<li>
Setupapi.lib (available in the Windows SDK) </li>
</ul>
<h3>Explicit Linking</h3>
<p>For explicit linking with the library, the application must explicitly load and unload libcaretaker_dynamic.dll. </p><ul>
<li>
Call LoadLibrary (or a similar function) to load the DLL and obtain a module handle. </li>
<li>
Call GetProcAddress to obtain a function pointer to each exported function that the application will call. </li>
<li>
Call FreeLibrary when done with the DLL. </li>
</ul>
<p>Sample code illustrating explicit linking is available in the <a class="el" href="group__explicit__linking.html">Unmanaged Explicit Linking Example</a> section.</p>
<h2>Debugging</h2>
<p>The library supports generating log messages with the following levels of verbosity.</p>
<table class="doxtable">
<tr>
<th>Log Level </th><th>Description </th></tr>
<tr>
<td>0 </td><td>Show all log messages. This is the most verbose level. </td></tr>
<tr>
<td>1 </td><td>Show informational, warning, and error messages only. </td></tr>
<tr>
<td>2 </td><td>Show warning and error messages only. </td></tr>
<tr>
<td>3 </td><td>Show error messages only. This is the least verbose level. </td></tr>
</table>
<p>The application can call the managed CareTaker.Device.SetLibraryLogLevel() API or the unmanaged <a class="el" href="group__unmanaged__secondary__api.html#ga0f4a1a0099592a7a0ddb1053d7a7e888" title="Sets the library log level. ">libct_set_log_level()</a> API to set the log level.</p>
<p>Log messages are written to standard output by default and will be printed to the console if the application was started there. The application can redirect library logs to a file as follows.</p>
<div class="fragment"><div class="line"><span class="comment">// Managed application code to redirect library logs to libcaretaker.log</span></div><div class="line"><a class="code" href="namespaceCaretaker.html">Caretaker</a>.<a class="code" href="classCaretaker_1_1Device.html">Device</a>.<a class="code" href="classCaretaker_1_1Device.html#a6cd9baaa21c213cb11b3fcea0a501f29">RedirectLibraryLogs</a>();</div></div><!-- fragment --><div class="fragment"><div class="line"><span class="comment">// Unmanaged application code to redirect library logs to libcaretaker.log</span></div><div class="line">FILE* logStream = NULL;</div><div class="line">freopen_s(&amp;logStream, <span class="stringliteral">&quot;libcaretaker.log&quot;</span>, <span class="stringliteral">&quot;w&quot;</span>, stdout);</div></div><!-- fragment --><p>Note log messages from the unmanaged library code will have the following format.</p>
<div class="fragment"><div class="line">DATE       TIME         LEVEL/FILTER   THREAD  MESSAGE</div><div class="line">---------- ------------ -------------- ------- ------------------------------------------------</div><div class="line">2018-08-01 14:47:34.632 I/libcaretaker (10592) <a class="code" href="group__unmanaged__primary__api.html#ga8577c848cdc2e70978f3ada3314727d7">libct_init</a> : Version: 0.0.0.f8b97f70.x64.debug</div><div class="line">2018-08-01 14:47:45.566 D/libcaretaker (06040) glue_rcv_thread : started.</div></div><!-- fragment --><p>The log levels are defined as follows. </p><ul>
<li>
D/ &ndash;&gt; Debug </li>
<li>
T/ &ndash;&gt; Trace </li>
<li>
I/ &ndash;&gt; Informational </li>
<li>
W/ &ndash;&gt; Warning </li>
<li>
E/ &ndash;&gt; Error </li>
</ul>
</div></div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Thu Oct 11 2018 10:47:18 for Caretaker Library API 1.6.5 Reference Manual by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.14
</small></address>
</body>
</html>
