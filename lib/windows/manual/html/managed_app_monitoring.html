<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.14"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Caretaker Library API 1.6.5 Reference Manual: Monitoring from Managed Application</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Caretaker Library API 1.6.5 Reference Manual
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.14 -->
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',false,false,'search.php','Search');
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">Monitoring from Managed Application </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p><br />
 This section provides an illustration to monitor Caretaker data from within a managed (.NET framework) application.</p>
<p>After adding the reference to the library as discussed in the <a class="el" href="windows_integration_overview.html">Library Integration</a> section, monitoring the Caretaker device can be done using the managed Device and supporting classes, which are available in the Caretaker name space.</p>
<h2>Asynchronous Monitoring</h2>
<p>The <a class="el" href="classCaretaker_1_1DeviceObserver.html" title="Managed class defining the application observer interface to receive real-time notifications. ">Caretaker.DeviceObserver</a> class provides an asynchronous interface to object-oriented application to receive Caretaker data and status information in real-time. Using this approach, the application calls <a class="el" href="classCaretaker_1_1Device.html" title="Managed class for .NET applications to monitor the Caretaker device. ">Caretaker.Device</a> class methods to read or write device data and receive the data and status information asynchronously in the application's DeviceObserver implementation.</p>
<p>The following code snippets illustrate C# code to create device and observer instances for asynchronous monitoring. </p><div class="fragment"><div class="line"><span class="comment">// Implement DeviceObserver to receive Caretaker data and status notifications.</span></div><div class="line"><span class="keyword">public</span> <span class="keyword">partial class </span>Observer : <a class="code" href="namespaceCaretaker.html">Caretaker</a>.DeviceObserver</div><div class="line">{</div><div class="line">    <span class="comment">// Override the methods to receive the desired data and status information.</span></div><div class="line">    <span class="comment">// See Caretaker.DeviceObserver class documentation for details.</span></div><div class="line">}</div><div class="line"></div><div class="line"><span class="comment">// Create the device and observer instances.</span></div><div class="line"><span class="comment">// Note the observer instance is passed as the first argument to the device constructor,</span></div><div class="line"><span class="comment">// and the second argument autoReconnect=true configures the device instance to automatically</span></div><div class="line"><span class="comment">// reconnect if the connection to the Caretaker device is lost, such as when the Caretaker device</span></div><div class="line"><span class="comment">// moves out of range.</span></div><div class="line">Observer observer = <span class="keyword">new</span> Observer();</div><div class="line"><a class="code" href="namespaceCaretaker.html">Caretaker</a>.<a class="code" href="classCaretaker_1_1Device.html">Device</a> device = <span class="keyword">new</span> <a class="code" href="namespaceCaretaker.html">Caretaker</a>.<a class="code" href="classCaretaker_1_1Device.html">Device</a>(observer, <span class="keyword">true</span>);</div><div class="line"></div><div class="line"><span class="comment">// Establish connection to a device that is advertising and timeout after 20 seconds.</span></div><div class="line"><span class="comment">// Note you can call device.ConnectToSerialNumber() to specify the Caretaker serial number to connect</span></div><div class="line"><span class="comment">// a specific device, or call device.Scan() to scan for a device.</span></div><div class="line"><span class="comment">// The connection status will be notified later to the application&#39;s DeviceObserver.OnConnectionStatus()</span></div><div class="line"><span class="comment">// implementation with status=CONNECTED if the connection was established.</span></div><div class="line">device.<a class="code" href="classCaretaker_1_1Device.html#a4afc0dabbaf6cac1e91256af4b53c02e">ConnectToAny</a>(20000);</div><div class="line"></div><div class="line">...</div><div class="line"></div><div class="line"><span class="comment">// Sometime later after the connection is established, start a calibration to receive data.</span></div><div class="line"><span class="comment">// Note StartManualCal() typically is invoked from DeviceObserver.OnConnectionStatus() for the</span></div><div class="line"><span class="comment">// CONNECTED status.</span></div><div class="line">device.StartManualCal(120, 75);</div><div class="line"></div><div class="line"><span class="comment">// After calibration, the various DeviceObserver methods will be notified when data is received.</span></div><div class="line"></div><div class="line">...</div><div class="line"></div><div class="line"><span class="comment">// Finally, call ReleaseResources() to release unmanaged resources allocated for the device instance.</span></div><div class="line"><span class="comment">// Note the device reference is no longer valid after calling ReleaseResources().</span></div><div class="line"><span class="comment">// Also, note ReleaseResources() cleans up unmanaged resources such as native threads and may delay the</span></div><div class="line"><span class="comment">// application thread as it waits for native threads to exit.</span></div><div class="line">device.ReleaseResources();</div><div class="line">device = null;</div></div><!-- fragment --><h2>Poll Monitoring</h2>
<p>The <a class="el" href="classCaretaker_1_1Device.html" title="Managed class for .NET applications to monitor the Caretaker device. ">Caretaker.Device</a> class also provides methods (getters) for procedural applications to poll Caretaker data. However, the methods must be called periodically to receive data after the connection is established. Note methods to get waveform data must be called at least 4 times per second to not drop data, while methods to get numeric data must be called at least once per second.</p>
<p>The following code illustrates snippet of C# code to create the device instance for poll monitoring. </p><div class="fragment"><div class="line"><span class="comment">// Create the device instance passing null observer as argument.</span></div><div class="line"><a class="code" href="namespaceCaretaker.html">Caretaker</a>.<a class="code" href="classCaretaker_1_1Device.html">Device</a> device = <a class="code" href="namespaceCaretaker.html">Caretaker</a>.<a class="code" href="classCaretaker_1_1Device.html">Device</a>(null, <span class="keyword">true</span>);</div><div class="line"></div><div class="line"><span class="comment">// Establish connection to a device that is advertising and timeout after 20 seconds.</span></div><div class="line">device.<a class="code" href="classCaretaker_1_1Device.html#a4afc0dabbaf6cac1e91256af4b53c02e">ConnectToAny</a>(20000);</div><div class="line"></div><div class="line"><span class="comment">// Poll for connected status and timeout after 21 seconds</span></div><div class="line"><span class="keywordtype">int</span> timeout = 21; </div><div class="line"><span class="keywordflow">while</span>(!device.IsConnected() &amp;&amp; --timeout &gt; 0) {</div><div class="line">    <a class="code" href="namespaceSystem.html">System</a>.Threading.Thread.Sleep(1000);</div><div class="line">}</div><div class="line"></div><div class="line"><span class="comment">// Start a calibration to receive data if connection was established.</span></div><div class="line"><span class="keywordflow">if</span> ( device.IsConnected() ) {</div><div class="line">    device.StartManualCal(120, 75);</div><div class="line"></div><div class="line">    <span class="comment">// Poll numeric data, waveform data and status information.</span></div><div class="line">    <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> count = 0;</div><div class="line">    <span class="keywordflow">while</span>(!exit) {</div><div class="line">        <span class="comment">// poll device status and numeric data once per second</span></div><div class="line">        <span class="keywordflow">if</span> ( count % 4 == 0 ) {</div><div class="line">            <a class="code" href="namespaceCaretaker.html">Caretaker</a>.<a class="code" href="classCaretaker_1_1DeviceStatus.html">DeviceStatus</a> deviceStatus = device.GetDeviceStatus();</div><div class="line">            <span class="keywordflow">if</span> (deviceStatus != null) {</div><div class="line">                <span class="comment">// display device status</span></div><div class="line">            }</div><div class="line"></div><div class="line">            <a class="code" href="namespaceCaretaker.html">Caretaker</a>.<a class="code" href="classCaretaker_1_1PrimaryVitals.html">PrimaryVitals</a> vitals = device.GetPrimaryVitals();</div><div class="line">            <span class="keywordflow">if</span> ( vitals != null ) {</div><div class="line">                <span class="comment">// display vitals</span></div><div class="line">            }</div><div class="line">        }</div><div class="line"></div><div class="line">        <span class="comment">// poll waveform data at least 4 times per second</span></div><div class="line">        <a class="code" href="namespaceCaretaker.html">Caretaker</a>.<a class="code" href="classCaretaker_1_1WaveformDataPoints.html">WaveformDataPoints</a> waveform = mCaretaker.GetPulsePressureWaveformDataPoints();</div><div class="line">        <span class="keywordflow">if</span> (waveform != null)</div><div class="line">        {</div><div class="line">            <span class="comment">// display waveform</span></div><div class="line">        }</div><div class="line"></div><div class="line">        <span class="comment">// sleep for 250 milliseconds</span></div><div class="line">        <a class="code" href="namespaceSystem.html">System</a>.Threading.Thread.Sleep(250);</div><div class="line">        count++;</div><div class="line">    }</div><div class="line">}</div><div class="line"></div><div class="line"><span class="comment">// Finally, call ReleaseResources() to release unmanaged resources allocated for the device.</span></div><div class="line"><span class="comment">// Note the device reference is no longer valid after calling ReleaseResources().</span></div><div class="line"><span class="comment">// Also, note ReleaseResources() cleans up unmanaged resources such as native threads and may delay the</span></div><div class="line"><span class="comment">// application thread as it waits for native threads to exit.</span></div><div class="line">device.ReleaseResources();</div><div class="line">device = null;</div></div><!-- fragment --> </div></div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Thu Oct 11 2018 10:47:18 for Caretaker Library API 1.6.5 Reference Manual by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.14
</small></address>
</body>
</html>
